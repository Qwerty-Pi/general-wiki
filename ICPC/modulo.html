<!DOCTYPE HTML>
<html>
<head>
	<script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_CHTML"></script>
	<link rel="stylesheet" type="text/css" href="../index.css">
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
	<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
	<script src="../function.js"></script>
</head>
<body>

<h1>Modular Arithmetic</h1>

<ol>
	<li>Compute Small Inverses, Discrete Log and Discrete Root in $\mathbb{Z}_n$.</li>
	<li>Introduce p-adic valuations $\nu_p$ and the theorem of Legendre and Lucas.</li>
	<li>Classify the group structure of $\mathbb{Z}_n^\times$, the multiplicative subgroup of $\mathbb{Z}_n$.</li>
</ol>

<h2>Introduction</h2>

<p>What is modular arithmetic? It is arithmetic done in $\mathbb{Z}_n = \mathbb{Z} / n\mathbb{Z} = \{ 0, 1, \cdots, n - 1 \}$ where $n$ is positive integer. Essentially, we try to recreate the mathematical operations done in $\mathbb{R}$ to $\mathbb{Z}_n$: $a + b$, $a - b$, $a \times b$, $a^b$, $a \div b$, $\log_a{b}$, $\sqrt{a}$, $\sqrt[b]{a}$, etc. You might know that $\mathbb{Z}_n$ is a ring, and $\mathbb{Z}_p$ is field iff $p$ is prime.</p>

<p>We denote $a \mid b$ as $a$ divides $b$ (or $b$ is multiple of $a$), and that $a \equiv b \pmod{m} \iff m \mid a - b$. </p>

<h2>Merging Equations</h2>

<p>Given two equations $X \equiv a \pmod{m}$ and $X \equiv b \pmod{n}$, how to merge them together? Clearly when $\gcd(m, n) \nmid a - b$, then no solution exists. Otherwise, we can always solve for unique $X \equiv c \pmod{\text{lcm}(m, n)}$. Indeed with extended euclidean algorithm then we have $mx + ny = \gcd(m, n)$ for some $x, y \in \mathbb{Z}$. Which then $mx \equiv \gcd(m, n) \pmod{n}$ and so $c = a + \frac{b - a}{\gcd(m, n)} \cdot mx$ satisfy the condition. Uniqueness is left as exercise.</p>

<h2>Operations Done Quick</h2>

<p>There are nothing to talk about $+$, $-$ and $\times$ (of course), while exponential $a^b$ is simply binary exponentiation in $O(\log b)$.</p>

<p>How about division? The result of $a \div b$ is well-defined iff $\gcd(b, m) = 1$, which then $1 \in \langle b \rangle$ or the order $|b|$ is finite. Since $\langle b \rangle$ is a subgroup of $\mathbb{Z}_m^\times$, $|b|$ divides $|\mathbb{Z}_m^\times| = \varphi(m)$ and $a^{\varphi(m)} \equiv 1 \pmod{m}$, which is the Euler's Theorem. A special case is when $m$ is prime, which then $\mathbb{Z}_m$ is a field and so $\varphi(m) = m - 1$. Thus $a^{-1} \equiv a^{\varphi(m) - 1} \pmod{m}$ can be computed in $O(\log m)$ time with binary exponentiation.</p>

<p>Alternatively, you can take a more Diophantine perspective - write it in multiplication as find $\lambda$ in $a \equiv \lambda b \pmod{m}$, and solve for $a = \lambda b + \mu m$ where $\lambda, \mu \in \mathbb{Z}$. This can be done by extended euclidean algorithm, also in $O(\log m)$.</p>

<p>Inverse for prefix of $\mathbb{Z}^+$ can be computed faster, noting $m \mod{a} = - a \lfloor \frac{m}{a}\rfloor \pmod{m}$ and so $a^{-1} = - (m \mod{a})^{-1} \lfloor \frac{m}{a}\rfloor \pmod{m}$.</p>

<p>Discrete logarithm (DLP) $\log_a{b} = \min \{k \in \mathbb{Z}_{\ge 0}: a^k \equiv b \pmod{m} \}$ is more complicated, and involve the baby-step giant-step algorithm - essentially define a block size $B$ and precompute all values $a^k$ where $0 \le k \lt B$ in a map, then check if $b \cdot a^{-lB} \pmod{m}$ is stored in the map. When $\gcd(a, m) \ne 1$ though, you need to manually check the few first terms $k$. Taking $B \sim \sqrt{m}$, we obtain a $O(\sqrt{m})$ algorithm.</p>

<p>Discrete square root for $m$ prime $\sqrt{a} = \{ x^2 \equiv a \pmod{m} : x \in \mathbb{Z}\}$ can be computed in $O(\log^2{m})$ by Tonelli-Shanks. We can Hensel Lift our way to prime power, and then with Chinese Remainder Theorem (CRT) to generalise to all positive integer $n$, as seen below.</p>

<p>Finally, discrete root $\sqrt[b]{a}$. For prime $p$, we can find primitive root $g \in \mathbb{Z}_p^\times$ where $\mathbb{Z}_p^\times = \langle g \rangle$. By talking $\log_g$ on $\sqrt[b]{a}$, we have $\sqrt[b]{a} = g^{(\log_g{a}) / b}$ which reduces the problem to DLP, which can be solved in $O(\sqrt{n})$. How about prime power? The best bet we have seems to be Hensel lifting. Suppose we have $X_k \in [0, p^k)$ and $X_k^b \equiv a \pmod{p^{k + \nu_p(b)}}$ with $\gcd(a, p) = 1$, where $\nu_p(b)$ is the largest $k$ that $p^k \mid b$. Case where $p \mid a$ can be handled trivially. Then suppose $X_{k+1} \in [0, p^{k+1})$ and $X_{k+1} \equiv X_k \pmod{p^{k + \nu_p(b)}}$, then $$ (X_k + \lambda p^k)^b \equiv X_k^b + b \lambda p^k X_k^{b - 1} \equiv a \pmod{p^{k+\nu_p(b)+1}} $$ We must have $$\lambda \equiv \frac{a - X_k^b}{b X_k^{b - 1}} \pmod{p} $$ Which again $$ X_{k+1} \equiv X_k - \frac{X_k^b - a}{b X_k^{b - 1}} \pmod{p^{k + 1}}$$ Consistent with the discrete sqrt result. Once again, we can use CRT to find discret root for any $n \in \mathbb{Z}^+$.</p>

<h2>p-adic valuations</h2>

<p>There are sometimes tasks asking for $\max \{ k : p^k \mid n! \} $ for some prime $p$. First of all, we should introduce the notation $\nu_p: \mathbb{Q}^+ \setminus \{ 0 \} \rightarrow \mathbb{Z}$ where $$ \nu_p(q) = \max \{ k \in \mathbb{Z} : \frac{q}{p^k} \in \mathbb{Z} \} $$ Which basically means the maximum power of prime that divides that number. For example, $\nu_2(40) = 3$ and $\nu_5(0.2) = -1$. Essentially, we can interpret this as a "logarithm" - noting $$ \nu_p(ab) = \nu_p(a) + \nu_p(b) $$</p>

<p>There are several interesting facts associated with this. First of all, we have the Legendre's formula: $$ \nu_p(n!) = \sum_{k \ge 1} \Big\lfloor \frac{n}{p^k} \Big\rfloor $$ Which then, for binomial coefficients $\binom{n}{r} = \frac{n!}{r!(n-r)!}$ we have the theorem of Lucas $$ \nu_p\Big(\binom{n}{r}\Big) = \nu_p(n!) - \nu_p((n - r)!) - \nu_p(r!) = \sum_{k \ge 1} \Big( \Big\lfloor \frac{n}{p^k} \Big\rfloor - \Big\lfloor \frac{n - r}{p^k} \Big\rfloor - \Big\lfloor \frac{r}{p^k} \Big\rfloor \Big) $$ Which is the number of carries in base $p$ when we add $r$ and $n - r$ together. When $\nu_p(\binom{n}{r}) = 0$, we can also compute $\binom{n}{r} \mod{p}$, noting that $(1 + X)^p \equiv 1 + X^p \pmod{p}$ and $\binom{n}{r} = [X^r] (1 + X)^n$. By writing $n = \overline{n_m n_{m - 1} \dots n_0 }$ and $r = \overline{r_m r_{m - 1} \dots r_0}$ in base $p$, then $$ \binom{n}{r} \equiv [X^r] (1 + X)^n \equiv \prod_{i = 0}^{m} [X^{r_i \cdot p^i}] (1 + X^{p^i})^{n_i} \equiv \prod_{i = 0}^{m} \binom{n_i}{r_i} \pmod{p} $$</p>

<h2>Group Structure of $\mathbb{Z}_n^\times$</h2>

<p>We want to have some investigation on $\mathbb{Z}_n^\times$, the multiplicative group of $\mathbb{Z}_n$. For example, $\mathbb{Z}_8^\times = \{ 1, 3, 5, 7 \} \cong \mathbb{Z}_2 \times \mathbb{Z}_2$ - there exists a isomorphism $\sigma$ from $\mathbb{Z}_2 \times \mathbb{Z}_2$ to $\mathbb{Z}_8^{\times}$ by $\sigma((a, b)) = 3^a \cdot 5^b$. How to classify all $\mathbb{Z}_n^\times$? Before we start, define $|\mathbb{Z}_n^\times| = \varphi(n)$, where $\varphi(n)$ is the Euler totient function.</p>

<p>First the most simple: prime $p$. We claim that $\mathbb{Z}_p^\times \cong \mathbb{Z}_{p-1} = \langle g \rangle$ for some $g \in \mathbb{Z}_p^\times$. There are many proofs out there, so I would explain in one of the ways - Consider subgroup $H \lt \mathbb{Z}_p^\times$ of order $d \mid p - 1$. Then for all $a \in H$, it satisfies $a^d - 1 = 0$ over field $\mathbb{Z}_p$, which has at most $d$ roots. Therefore, there must be at most one subgroup $H$ for each $d \mid p - 1$, and the number of elements with order $d$ is at most $\varphi(d)$. Since $n = \sum_{d \mid n} \varphi(d)$, the equality case is forced and so the number of elements with order $d$ is exactly $\varphi(d)$, implying generator for $\mathbb{Z}_p^\times$ exists.</p>

<p>How about prime powers $q = p^k$? For $k = 2$, we actually have $\langle g \rangle \lt \mathbb{Z}_{p^2}$ where $p - 1 \mid |g|$, and so either $|g| = (p - 1) p$ directly or $|g| = p - 1$. In the later case, $\mathbb{Z}_{p^2}^\times \cong \langle p + 1 \rangle \times \langle g \rangle \cong \mathbb{Z}_{p} \times \mathbb{Z}_{p - 1} \cong \mathbb{Z}_{p(p-1)}$, generated by either $(p + 1) g$. How about $k \ge 3$? Can we go up inductively? Kind of yes. First note that $H_b = \{ ap^b + 1: a \in \mathbb{Z}_q \} $ for $b \ge 1$ forms a subgroup of $\mathbb{Z}_q^\times$ where $|H_b| = p^{k - b}$. When is $H_b$ cyclic? Since $p^b + 1 \in H_b$, if $(1 + p^b)^{p^{k - 1 - b}} \not \equiv 1 \pmod{p^k}$ then $H_b$ is cyclic. Note that $$ (1 + p^b)^{p^{k - 1 - b}} \equiv 1 + p^{k - 1 - b} \cdot p^b + \binom{p^{k - 1 - b}}{2} \cdot p^{2b} + \cdots \equiv 1 + p^{k - 1} - \frac{p^{k - 1 + b}}{2} \pmod{p^k} $$ Unfortunately, when $p = 2$ and $b = 1$, the expression indeed $\equiv 1 \pmod{p^k}$. Luckily that is the only corner case, and so $\langle p + 1 \rangle$ generates $H_1$ for all odd prime $p$, and $\langle p^2 + 1 = 5 \rangle$ generates $H_2$ for $p = 2$. Since $\mathbb{Z}_q \cong H_1 \times \mathbb{Z}_{p - 1}$, for odd prime $p$ we have $\mathbb{Z}_q \cong \mathbb{Z}_{(p - 1) p^k}$, whereas for $p = 2$ we have $\mathbb{Z}_{p^k} \cong H_2 \times \mathbb{Z}_2 \cong \mathbb{Z}_{p^{k - 2}} \times \mathbb{Z}_2$. </p>

<p>Finally, how to generalise for compositie $n$? Chinese remainder theorem is your friend! The key claim is that for every co-prime $n$ and $m$, we have $$ \mathbb{Z}^\times_{n \times m} = \mathbb{Z}^\times_{n} \times \mathbb{Z}^\times_{m} $$ Therefore, we can simply re-use the result for prime power to compute for composite $n$. In general, for number-theoric tasks, there is a high chance that you can first break it down to its prime factorisation.</p>
